with all_data as (
	select 
		spen.*
		,sub.*
	from (
		select 
			signup_country_code
			,sum(subscription_count) as subscription_count
			,sum(net_revenue) as net_revenue
		from data_analyst_case.dwh.subscriptions
		group by 
			signup_country_code
		) sub
	full outer join (
		select 
			country_code
			,sum(spendings) as total_spending
		from data_analyst_case.dwh.spendings
		group by 
			country_code
		) spen
		on sub.signup_country_code = spen.country_code
) 
select 
	country_code
	,round(cast(total_spending as numeric),2) as total_spending
	,coalesce(subscription_count,0) as subscription_count
	,round(cast(coalesce(total_spending/subscription_count,0) as numeric),2) as spending_per_subscription
from all_data
order by country_code